{% extends "base.html" %}

{% block title %}Admin Dashboard - Barnatore Meld Pharm{% endblock %}

{% block content %}
<div class="admin-container section-container">
    <div class="admin-header" style="display: flex; flex-direction: column; gap: 1.5rem; align-items: stretch;">
        <div style="display: flex; justify-content: space-between; align-items: center; flex-wrap: wrap; gap: 1rem;">
            <h1 class="section-title" style="font-size: 1.75rem; margin-bottom: 0;">Admin Dashboard</h1>
            <div style="display: flex; gap: 0.75rem;">
                <a href="{{ url_for('admin.orders') }}" class="btn btn-secondary">Menaxho Porositë</a>
                <a href="{{ url_for('admin.new_product') }}" class="btn btn-primary">Shto Produkt Të Ri</a>
            </div>
        </div>
        
        <div class="search-box-admin" style="position: relative; width: 100%;">
            <i class="fas fa-search" style="position: absolute; left: 1.5rem; top: 50%; transform: translateY(-50%); color: #64748b; font-size: 1.25rem;"></i>
            <input type="text" id="adminProductSearch" placeholder="Kërko produkte sipas emrit ose kategorisë..." 
                   style="width: 100%; padding: 1.25rem 1.5rem 1.25rem 4rem; border: 1px solid #e2e8f0; border-radius: 20px; outline: none; transition: var(--transition); font-size: 1.1rem; box-shadow: var(--shadow-md);">
        </div>
    </div>

    <div class="table-responsive">
        <table class="table admin-table admin-product-table">
            <thead>
                <tr>
                    <th style="width: 40%;">Emri</th>
                    <th style="width: 25%;">Kategoria</th>
                    <th style="width: 15%;">Çmimi</th>
                    <th style="width: 20%;">Veprime</th>
                </tr>
            </thead>
            <tbody>
                {% for product in products %}
                <tr>
                    <td>{{ product.name }}</td>
                    <td>{{ product.category }}</td>
                    <td>€{{ product.price }}</td>
                    <td>
                        <a href="{{ url_for('admin.edit_product', product_id=product._id) }}" class="btn btn-sm btn-info btn-icon-only" title="Ndrysho">
                            <i class="fas fa-edit"></i>
                        </a>
                        <form action="{{ url_for('admin.delete_product', product_id=product._id) }}" method="POST" style="display:inline;" onsubmit="return confirmDelete(this);">
                            <input type="hidden" name="csrf_token" value="{{ csrf_token() }}"/>
                            <button type="submit" class="btn btn-sm btn-danger btn-icon-only" title="Fshije">
                                <i class="fas fa-trash-alt"></i>
                            </button>
                        </form>
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
</div>

<script>
document.getElementById('adminProductSearch').addEventListener('input', function(e) {
    const term = e.target.value.toLowerCase();
    const rows = document.querySelectorAll('.admin-table tbody tr');
    
    rows.forEach(row => {
        const name = row.cells[0].textContent.toLowerCase();
        const category = row.cells[1].textContent.toLowerCase();
        
        if (name.includes(term) || category.includes(term)) {
            row.style.display = '';
        } else {
            row.style.display = 'none';
        }
    });
});

function confirmDelete(form) {
    if (confirm('A jeni i sigurt që dëshironi të fshini këtë produkt?')) {
        return true;
    }
    return false;
}
</script>
{% endblock %}
